// ========================================
// ТАБЛИЦЫ
// ========================================

Table user_roles {
  id serial [primary key]
  name varchar(50)
}

Table users {
  id serial [primary key]
  first_name varchar(50)
  last_name varchar(50)
  email varchar(100) [unique]
  password varchar(100)
  contact_num varchar(15)
  role_id bigint
  age int
}

Table genres {
  id serial [primary key]
  name varchar(50)
}

Table countries {
  id serial [primary key]
  name varchar(50) [unique]
}

Table age_restrictions {
  id serial [primary key]
  age_restriction int [unique]
}

Table movies {
  id serial [primary key]
  title varchar(100)
  description text
  release_date date
  rating decimal(2,1)
  duration interval
  genre_id bigint
  country_id bigint
  age_restriction_id bigint
}

Table directors {
  id serial [primary key]
  first_name varchar(50)
  last_name varchar(50)
}

Table actors {
  id serial [primary key]
  first_name varchar(50)
  last_name varchar(50)
}

Table cinemas {
  id serial [primary key]
  name varchar(100)
  address varchar(200)
}

Table halls {
  id serial [primary key]
  cinema_id int
  hall_num int
  capacity int
}

Table seat_types {
  id serial [primary key]
  name varchar(50) [unique]
}

Table seats {
  id serial [primary key]
  hall_id int
  row_num int
  seat_num int
  seat_type_id int
}

Table showtimes {
  id serial [primary key]
  movie_id int
  hall_id int
  startime timestamp
}

Table tickets {
  id serial [primary key]
  showtime_id int
  seat_id int
  user_id int
  price decimal(8,2)
}

Table reservations {
  id serial [primary key]
  user_id bigint
  reservation_time timestamp
}

Table languages {
  id serial [primary key]
  name varchar(50) [unique]
}

Table online_movies {
  id serial [primary key]
  movie_id int
  language_id bigint
  url text
  created_at timestamp
  updated_at timestamp
}

Table views {
  id serial [primary key]
  online_movie_id int
  view_time timestamp
  view_dur_time interval
  user_id int
}

Table reviews {
  id serial [primary key]
  movie_id int
  rating int
  comment text
  created_at timestamp
  updated_at timestamp
}

Table payment_methods {
  id serial [primary key]
  name varchar(50) [unique]
}

Table payments {
  id serial [primary key]
  reservation_id int
  payment_method_id bigint
  created_at timestamp
  amount decimal(8,2)
}

Table adv_type {
  id serial [primary key]
  name varchar(50) [unique]
  priority int
}

Table advertisements {
  id serial [primary key]
  title varchar(100)
  description text
  url text
  type_id bigint
}

Table ad_views {
  id serial [primary key]
  ad_id int
  view_id int
  user_id int
  viewed_at timestamp
  successful boolean
}

Table movie_director {
  id serial [primary key]
  movie_id bigint
  director_id bigint
}

Table movie_actor {
  id serial [primary key]
  movie_id bigint
  actor_id bigint
}

Table movie_genre {
  id serial [primary key]
  movie_id bigint
  genre_id bigint
}

Table playlist {
  id serial [primary key]
  user_id bigint
  name varchar(50)
}

Table playlist_movies {
  id serial [primary key]
  movie_id bigint
  playlist_id bigint
  created_at timestamp
}

Table recommendation {
  id serial [primary key]
  user_id bigint
  movie_id bigint
  review_id bigint
  created_at timestamp [default: `now()`]
}

// ========================================
// ВНЕШНИЕ КЛЮЧИ
// ========================================

Ref: users.role_id > user_roles.id [delete: set null]

Ref: movies.genre_id > genres.id [delete: set null]
Ref: movies.country_id > countries.id [delete: set null]
Ref: movies.age_restriction_id > age_restrictions.id [delete: set null]

Ref: halls.cinema_id > cinemas.id [delete: cascade]

Ref: seats.hall_id > halls.id [delete: cascade]
Ref: seats.seat_type_id > seat_types.id [delete: set null]

Ref: showtimes.movie_id > movies.id [delete: cascade]
Ref: showtimes.hall_id > halls.id [delete: cascade]

Ref: tickets.showtime_id > showtimes.id [delete: cascade]
Ref: tickets.seat_id > seats.id [delete: set null]
Ref: tickets.user_id > users.id [delete: set null]

Ref: reservations.user_id > users.id [delete: cascade]

Ref: online_movies.movie_id > movies.id [delete: cascade]
Ref: online_movies.language_id > languages.id [delete: set null]

Ref: views.online_movie_id > online_movies.id [delete: cascade]
Ref: views.user_id > users.id [delete: set null]

Ref: reviews.movie_id > movies.id [delete: cascade]

Ref: payments.reservation_id > reservations.id [delete: cascade]
Ref: payments.payment_method_id > payment_methods.id [delete: set null]

Ref: advertisements.type_id > adv_type.id [delete: set null]

Ref: ad_views.ad_id > advertisements.id [delete: cascade]
Ref: ad_views.user_id > users.id [delete: set null]
Ref: ad_views.view_id > views.id [delete: set null]

Ref: movie_actor.movie_id > movies.id [delete: cascade]
Ref: movie_actor.actor_id > actors.id [delete: cascade]

Ref: movie_genre.movie_id > movies.id [delete: cascade]
Ref: movie_genre.genre_id > genres.id [delete: cascade]

Ref: playlist.user_id > users.id [delete: cascade]

Ref: playlist_movies.playlist_id > playlist.id [delete: cascade]
Ref: playlist_movies.movie_id > movies.id [delete: cascade]

Ref: recommendation.user_id > users.id [delete: cascade]
Ref: recommendation.movie_id > movies.id [delete: cascade]
Ref: recommendation.review_id > reviews.id [delete: set null]

Ref: movie_director.movie_id > movies.id [delete: cascade]
Ref: movie_director.director_id > directors.id [delete: cascade]