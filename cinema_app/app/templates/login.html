<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í—Ö–æ–¥ - Cinema</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .login-container {
            max-width: 450px;
            margin: 80px auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="login-container">
            <div class="card shadow">
                <div class="card-body p-4">
                    <h3 class="card-title text-center mb-4">üé¨ –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h3>

                    <div id="error-alert" class="alert alert-danger d-none"></div>
                    <div id="success-alert" class="alert alert-success d-none"></div>

                    <ul class="nav nav-tabs mb-3" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="login-tab" data-bs-toggle="tab" data-bs-target="#login" type="button">
                                –í—Ö–æ–¥
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="register-tab" data-bs-toggle="tab" data-bs-target="#register" type="button">
                                –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
                            </button>
                        </li>
                    </ul>

                    <div class="tab-content">
                        <div class="tab-pane fade show active" id="login" role="tabpanel">
                            <form id="loginForm">
                                <div class="mb-3">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-control" id="login-email" required>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
                                    <input type="password" class="form-control" id="login-password" required>
                                </div>

                                <button type="submit" class="btn btn-primary w-100">–í–æ–π—Ç–∏</button>
                            </form>

                            <hr>

                            <p class="text-muted small text-center mb-2">–î–µ–º–æ-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (–ø–∞—Ä–æ–ª—å: password123):</p>
                            <div class="d-grid gap-2">
                                <button class="btn btn-sm btn-outline-secondary" onclick="quickLogin('ivan@example.com')">
                                    üë® Ivan (25 –ª–µ—Ç)
                                </button>
                                <button class="btn btn-sm btn-outline-secondary" onclick="quickLogin('anna@example.com')">
                                    üë© Anna (19 –ª–µ—Ç)
                                </button>
                                <button class="btn btn-sm btn-outline-warning" onclick="quickLogin('sergey@example.com')">
                                    üßí Sergey (17 –ª–µ—Ç - —Ç–µ—Å—Ç –≤–æ–∑—Ä–∞—Å—Ç–∞)
                                </button>
                            </div>
                        </div>

                        <div class="tab-pane fade" id="register" role="tabpanel">
                            <form id="registerForm">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">–ò–º—è</label>
                                        <input type="text" class="form-control" id="reg-firstname" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">–§–∞–º–∏–ª–∏—è</label>
                                        <input type="text" class="form-control" id="reg-lastname" required>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-control" id="reg-email" required>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
                                    <input type="password" class="form-control" id="reg-password" required minlength="6">
                                    <small class="text-muted">–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤</small>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">–í–æ–∑—Ä–∞—Å—Ç</label>
                                    <input type="number" class="form-control" id="reg-age" min="1" max="120" required>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                                    <input type="tel" class="form-control" id="reg-phone" placeholder="+7 999 123 45 67">
                                </div>

                                <button type="submit" class="btn btn-success w-100">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                            </form>
                        </div>
                    </div>

                    <div class="text-center mt-3">
                        <a href="/ui" class="text-muted small">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        const errorAlert = document.getElementById('error-alert');
        const successAlert = document.getElementById('success-alert');

        function showError(message) {
            errorAlert.textContent = message;
            errorAlert.classList.remove('d-none');
            successAlert.classList.add('d-none');
        }

        function showSuccess(message) {
            successAlert.textContent = message;
            successAlert.classList.remove('d-none');
            errorAlert.classList.add('d-none');
        }

        function quickLogin(email) {
            document.getElementById('login-email').value = email;
            document.getElementById('login-password').value = 'password123';
        }

        // –í–•–û–î
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            try {
                const response = await axios.post('/auth/login', { email, password });
                localStorage.setItem('token', response.data.access_token);
                window.location.href = '/ui';
            } catch (error) {
                showError(error.response?.data?.detail || '–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞');
            }
        });

        // –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const data = {
                first_name: document.getElementById('reg-firstname').value,
                last_name: document.getElementById('reg-lastname').value,
                email: document.getElementById('reg-email').value,
                password: document.getElementById('reg-password').value,
                age: parseInt(document.getElementById('reg-age').value),
                contact_num: document.getElementById('reg-phone').value || null
            };

            try {
                const response = await axios.post('/auth/register', data);
                showSuccess('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –°–µ–π—á–∞—Å –≤—ã–ø–æ–ª–Ω–∏–º –≤—Ö–æ–¥...');

                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥ –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
                setTimeout(async () => {
                    const loginResponse = await axios.post('/auth/login', {
                        email: data.email,
                        password: data.password
                    });
                    localStorage.setItem('token', loginResponse.data.access_token);
                    window.location.href = '/ui';
                }, 1500);

            } catch (error) {
                showError(error.response?.data?.detail || '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏');
            }
        });
    </script>
</body>
</html>